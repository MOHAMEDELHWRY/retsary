# دليل اختبار ميزة التسجيل التلقائي في سجل العمليات 🧪

## خطوات الاختبار

### 1. التحضير للاختبار
```
✅ تأكد من تشغيل الخادم على localhost:9003
✅ افتح تقرير العملاء: /customers-log
✅ افتح لوحة التحكم في تبويب منفصل: /
```

### 2. اختبار إضافة فاتورة جديدة
```
📝 في صفحة أرصدة العملاء:
┌─────────────────────────────────────────┐
│ اسم العميل: [أحمد محمد الاختبار]       │
│ مبلغ الفاتورة: [1500]                  │
│ تاريخ الفاتورة: [2025-08-03]           │
│ رقم العملية: [اتركه فارغ للاختبار]     │
│                                         │
│        [إضافة الفاتورة]                 │
└─────────────────────────────────────────┘
```

### 3. التحقق من النتائج

#### أ) في صفحة أرصدة العملاء:
```
✅ يجب أن تظهر الفاتورة الجديدة في الجدول
✅ يجب أن يظهر رقم العملية في العمود الأول
✅ يجب أن تظهر رسالة تأكيد تتضمن:
   - رقم الفاتورة (مثل: INV-001)
   - رقم العملية (مثل: OP-20250803-1234)
   - تأكيد التسجيل في أرصدة العملاء
   - تأكيد التسجيل في سجل العمليات
```

#### ب) في لوحة التحكم (سجل العمليات):
```
✅ انتقل إلى لوحة التحكم الرئيسية
✅ ابحث في جدول العمليات عن:
   - رقم العملية: OP-20250803-1234
   - اسم العميل: أحمد محمد الاختبار
   - الوصف: فاتورة مبيعات للعميل أحمد محمد الاختبار
   - التصنيف: مبيعات
   - النوع: فاتورة عميل
   - المبلغ: 1500 في خانة إجمالي البيع
```

### 4. اختبار رقم عملية مخصص
```
📝 اختبار ثاني برقم عملية مخصص:
┌─────────────────────────────────────────┐
│ اسم العميل: [سارة أحمد]                │
│ مبلغ الفاتورة: [2000]                  │
│ تاريخ الفاتورة: [2025-08-03]           │
│ رقم العملية: [TEST-001]               │
│                                         │
│        [إضافة الفاتورة]                 │
└─────────────────────────────────────────┘

✅ يجب أن يظهر رقم العملية كما أُدخل: TEST-001
✅ يجب أن تظهر العملية في سجل العمليات برقم TEST-001
```

### 5. التحقق من console.log
```
🔍 افتح Developer Tools (F12)
🔍 انتقل إلى تبويب Console
✅ يجب أن ترى رسالة: 
   "✅ تم تسجيل العملية في سجل العمليات بنجاح: OP-20250803-1234"
```

### 6. اختبار معالجة الأخطاء
```
💡 لاختبار معالجة الأخطاء (اختياري):
- قم بإيقاف الاتصال بالإنترنت مؤقتاً
- أضف فاتورة جديدة
- يجب أن تظهر رسالة تحذير تشير لعدم تمكن التسجيل في سجل العمليات
```

## النتائج المتوقعة

### ✅ نجح الاختبار إذا:
- [✓] الفاتورة ظهرت في أرصدة العملاء
- [✓] رقم العملية ظهر في الجدول
- [✓] العملية ظهرت في سجل العمليات بلوحة التحكم
- [✓] جميع البيانات متطابقة (الاسم، التاريخ، المبلغ)
- [✓] رسالة التأكيد تشير للتسجيل في كلا النظامين

### ❌ فشل الاختبار إذا:
- [✗] الفاتورة لم تظهر في أرصدة العملاء
- [✗] رقم العملية لم يظهر أو ظهر فارغاً
- [✗] العملية لم تظهر في سجل العمليات
- [✗] البيانات غير متطابقة بين النظامين
- [✗] ظهرت رسائل خطأ في console.log

## استكشاف الأخطاء

### إذا لم تظهر العملية في سجل العمليات:
```
🔧 تحقق من:
1. الاتصال بالإنترنت (Firebase يحتاج إنترنت)
2. تسجيل الدخول (يجب أن تكون مسجل دخول)
3. أذونات Firebase (راجع console للأخطاء)
4. التأكد من استيراد useTransactions بشكل صحيح
```

### إذا ظهرت أخطاء في console:
```
🔧 أخطاء شائعة وحلولها:
- "User not authenticated" → تأكد من تسجيل الدخول
- "Firebase permission denied" → راجع قواعد Firebase
- "Network error" → تحقق من الاتصال بالإنترنت
```

---

## ملاحظات مهمة

⚠️ **هذا الاختبار يتطلب:**
- تسجيل دخول في النظام
- اتصال بالإنترنت (لـ Firebase)
- صلاحيات كتابة في قاعدة البيانات

💡 **نصائح للاختبار:**
- استخدم أسماء عملاء وهمية للاختبار
- احتفظ بصورة شاشة للنتائج
- اختبر كلاً من التوليد التلقائي والرقم المخصص

تاريخ الإنشاء: أغسطس 2025
نوع الاختبار: اختبار تكامل النظام
الحالة: جاهز للتنفيذ ✅
